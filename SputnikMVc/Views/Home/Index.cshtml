
<div id="menu-lateral">
    <ul>
        <li><a asp-controller="Home" asp-action="Index"><i class="fa fa-home"></i> Início</a></li>
        <li><a href="#"><i class="fa fa-search"></i> Buscar</a></li>
        <li><a href="#"><i class="fa fa-book"></i> Sua biblioteca</a></li>
        <li><a asp-controller="Artista" asp-action="Create"><i class="fa fa-user-plus"></i>Criar Artista</a></li>
        <li><a asp-controller="Album" asp-action="Create"><i class="fa fa-user-plus"></i>Criar Album</a></li>
        <li><a asp-controller="Youtube" asp-action="Create"><i class="fa fa-user-plus"></i>Download musica</a></li>
        <li><a href="#"><i class="fa fa-plus"></i> Criar playlist</a></li>
        <li><a href="#"><i class="fa fa-heart"></i> Músicas curtidas</a></li>
    </ul>
</div>
<main role="main" class="Global pb-3 mr-5">
    <div class="space">
    </div>
    <div class="Render" id="mostraNaTela" >

    </div>

</main>
<div class="menu-container">
    <form class="search-form" action="#" method="get">
        <label for="search-input" class="sr-only">Pesquisar</label>
        <div class="search-wrapper">
            <input type="text" id="search-input" placeholder="Pesquisar">
            <span class="search-icon"><i class="fa fa-search"></i></span>
        </div>
    </form>
    <div class="user-info">
        <img src="caminho/para/imagem" alt="Imagem do usuário">
        <span>Usuário</span>
    </div>
</div>
<div id="componente-container">
    @Html.Partial("Player")
</div>
<script>
  
    $(document).load('on',() => {
        debugger
        this.Get('Artista/index')
        verificaMusica()
    })
    var MusicaPlayer = document.getElementById('MusicaPlayer');
    var id = ""
    MusicaPlayer.addEventListener("timeupdate", function () {
        var currentTime = MusicaPlayer.currentTime;
        var duration = MusicaPlayer.duration;
        console.log(document.getElementById('MusicaPlayer').currentTime)
        localStorage.setItem('CurrentTime', MusicaPlayer.currentTime);
        var percent = (currentTime / duration) * 100;
        document.getElementById('progress-bar').style.width = percent + "%";
    });
    MusicaPlayer.addEventListener("ended", function () {
        if (id != null) {
            parseInt(id) += 1
        }
        playMusica(id)

    });
    function playMusica(id, CurrentTime) {
        debugger

        id = id
        var baseUrl = window.location.protocol + "//" + window.location.hostname;
        if (window.location.port) {
            baseUrl += ":" + window.location.port;
        }
        debugger
        var xhr = new XMLHttpRequest();
        xhr.open('GET', `${baseUrl}/Musica/GetArquivoMp3?id=${id}`, true);
        xhr.responseType = 'arraybuffer';

        xhr.send();
        xhr.onload = function () {
            if (xhr.status === 200) {
                debugger
                var blob = new Blob([xhr.response],
                    { type: 'audio/mpeg' });
                var url = URL.createObjectURL(blob);
                MusicaPlayer.setAttribute('src', url)
                if (CurrentTime != null)
                    document.getElementById('MusicaPlayer').currentTime = CurrentTime
                MusicaPlayer.play();


            }
        };
        localStorage.setItem('idMusica', id);
    }
    function Get(url) {
        debugger
        $("#title").html(url)
        console.log($("#title"))
        url = '@Url.Content("~/")' + url;
        $.ajax({
            url: url,
            type: 'GET',
            success: function (response) {
                console.log(response)
                $("#mostraNaTela").html(response)
            },
            error: function () {
                alert('Ocorreu um erro!');
            }
        });
    }
    
    function verificaMusica() {
        var MusicaPlayer = document.getElementById('MusicaPlayer');
        debugger
        if (localStorage.getItem('idMusica')) {
            var id = localStorage.getItem('idMusica');
            var tempoPercorrido = localStorage.getItem('CurrentTime')
            playMusica(id, tempoPercorrido)

        }
    }
</script>